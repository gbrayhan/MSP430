
# noccyONE

msp430-based 8-bit synth

<pre>
                                                               _
          |                                                /\ | \ /_
        | |  .::::::. .::::::. .::::::. .::::::. :::  :::  \/ | / \
        | |  :::  ::: :::  ::: :::  ''' :::  ''' :::  :::
        | |  :::  ::: :::  ::: :::  ... :::  ... :::  :::
        | |  :::  ::: '::::::' '::::::' '::::::' ':::::::
        | |                                      .....:::
        | |____                                  '''''''
        |____
</pre>

Concept and Design by NoccyLabs. Copyright (C) 2012, NoccyLabs. This project
is 100% open source

--------------------------------------------------------------------------------

NOTE: This is more of a mindmap at the moment. Work in progress!

--------------------------------------------------------------------------------

## Bill Of Materials

* 1x LM1086 3.3V 1.5A Low Dropout Positive Regulator
* 1x MSP430G2553 MCU 16KB
* 1x MSP430G2452 MCU 8KB
* 1x TDA1543 Dual 16-bit DAC

## Modules

    .-----------------------------------.
    |                                   |
    |         Waveform Generator        |   Waveform Generators
    |                                   |
    |                 .-----------.-----|
    |                 | Square    | PWM |   Square wave with PWM
    |                 |--------.--'-----|
    |                 | Saw    : Tri    |   Saw or Triangle wave
    |                 |--------'--------|
    |                 | Sine            |   Sine wave
    |                 |-----------------|
    |                 | Sampler         |   Sampled waveforms
    |                 '-----------------|
    |                                   |
    |        .        .        .        |
    |        |        |        |        |
    |  OSC1  |  OSC2  |  OSC3  |  OSCn  |   Oscillators with ADSR envelope.
    |        |        |        |        |   This accounts for polyphony.
    |  .-----|  .-----|  .-----|  .-----|
    |  | Env |  | Env |  | Env |  | Env |   Envelope generators.
    |  '-----:  '-----:  '-----:  '-----|
    |        :        :        :        |   Effects block, such as ringmod
    |        :  Effects Block  :        |   (reduces polyphony), distortion
    |        :        :        :        |   or low pass filter.
    |········'········'········'········|
    |                                   |   Mixer block mix the channels with
    |            Mixer Block            |   a simple So=(S1+S2+..+Sn)/n
    |                                   |
    |-----------------------------------|
    |                                   |   Master effects
    |           Effects Block           |
    |                                   |
    |-----------------.-----------------|
    |                 :                 |   Output to serial 16-bit DAC or
    |    16 bit DAC   :    8 bit DAC    |   parallel 8-bit DAC.
    |                 :                 |
    '-----------------'-----------------'

### Waveform Generator

The waveform generator is able to produce five basic waveforms with varying
polyphony (as certain generators require more resources to run). When using
some effects an additional generator may be needed.

The square wave generator allows the pulse width to be set, achieving pulse
width modulation.

The saw wave generator can become a triangle wave, and thus both saw and
triangle are generated by the same generator.

Sine wave is a basic sample-based sine wave. To generate the sample data, use
the wavegen script as such:

    $ ./wavegen --sine -r 1000 -e -o sine.h

### Sampler

To generate samples for the sampler, use the same tool but with the --raw
argument.

    $ ./wavegen --raw sample.raw -e -r 1000 -o sample.h
    
### Envelope Generators

The envelope generators will generate basic ADSR envelopes. All values are
bytes between 0 and 255 for 8-bit operation. The envelope steps for attack,
decay and release are evaluated in cycles as 1/n. Sustain is the amplification
level.

    |--A---|-D-|     |-R-|
    :     /:\  :     :   :
    :    / : \ :     :   :
    :   /  :  \:_____:   :
    :  /   :   :  :  :\  :
    : /    :   :  S  : \ :
    :/     :   :  :  :  \:

### Effects

Effects are implemented on top of each of the oscillators as well as on the
master step.

The effect instances 

#### Saturator

A saturation unit.

    int afx_saturator(int saturation)

#### Compressor

A basic compressor

    int afx_compressor(int threshold, int attack, int release, int ratio)

#### Flanger

Adds a delay with a slight shift panning between a low and a high value. The
rate at which this panning occurs is defined by the LFO which takes a value in
herz.

    int afx_flanger(int low, int high, int lfo)

### Mixer Block

            O1 + O2 + O3 + .. + On
    Sout = ------------------------
                      n

## Routing and Processing

Four oscillators are set up as default:

    Oscillator osc[4];

For each received note:

    note_off(o);
    reset_envelope(o);
    note_on(o,v);

The main loop will go over each of the oscillators, and in order assign MIDI
notes to each of the oscillators. When the note_on() is received, an internal
timer resets and the envelope generator is queried for the envelope value at
tick n. When the sustain point is reached the sustained value is continuosly
returned. When the note_off() is received, the timer is yet again reset and
this time the release curve is returned.
    
    int env = get_envelope(o,n);
    int osc = get_oscillator(o,n);
    int ofx = get_osc_effect(o,osc);
    int out = ofx * env;
    int outsum += out;

The output is then mixed and sent through the master effect step:

   int mix = outsum / numosc
   int mfx = get_master_effect(mix);

Finally, the timer takes care of pushing the current mixed value to the DAC
in parallel 8-bit format (P1.0-P1.7) or serial 16-bit format (P1.5-P1.6)

### Multilayered routing

The oscillator block can be layered with a reduced polyphony as the result.
     

## Programs

Programs are created from a oscillator together with envelope defaults and
filter chains.
    
## MIDI CCs

    CC   Controls
    ---  --------
    12   Waveform [Square/Saw/Triangle/Sine/Sample(n)]
    13   PWM (Only Square wave)
    14   Attack time
    15   Decay time 
    16   Sustain value (Maps to 0.0-1.0)
    17   Release time 

